<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-29 Wed 21:32 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LKMP Getting Started</title>
<meta name="author" content="Albin Babu Varghese" />
<meta name="description" content="My journey into Linux Kernel Bug Fixing as part of LKMP Fall 2025" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="https://albus-droid.github.io/portfolio/templates/style.css"/>
<script src="https://albus-droid.github.io/portfolio/templates/typewriter-name.js" defer></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"><script src="https://albus-droid.github.io/portfolio/templates/highlight-code.js" defer></script>
</head>
<body>
<div id="preamble" class="status">
<h1 id="name-typewriter"></h1>
<div class="container">
    <div class="social-links">
        <a href="https://github.com/albus-droid" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
            <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297 24 5.67 18.627.297 12 .297z"/></svg>
        </a>
        <a href="https://linkedin.com/in/albin-babu-varghese" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.225 0z"/></svg>
        </a>
        <a href="mailto:albinbabuvarghese@gmail.com" aria-label="Email">
        <svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Email</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.75L12 16.625l-6.545-4.875v9.25H1.636C.732 21 .001 20.269.001 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.908 1.528-1.145C21.69 3.28 24 4.435 24 5.457z"/></svg>
        </a>
    </div>
    <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="/" class="nav-link">[HOME]</a>
        <a href="resume.html" class="nav-link">[RESUME]</a>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
document.querySelectorAll('pre[class*="src-"]').forEach(pre => {
  const match = pre.className.match(/src-(\w+)/);
  if (match) {
    const lang = match[1];
    let code = pre.querySelector('code');
    if (!code) {
      code = document.createElement('code');
      code.textContent = pre.textContent;
      pre.textContent = '';
      pre.appendChild(code);
    }
    code.className = `language-${lang}`;
  }
});
hljs.highlightAll();
</script>
</div>
<div id="content" class="content">
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#baby-steps">1. Baby Steps</a>
<ul>
<li><a href="#orgd8ba582">1.1. Typical Workflow</a></li>
</ul>
</li>
<li><a href="#tools">2. Tools for Linux Kernel Bug Fixing</a>
<ul>
<li><a href="#core-debugging">2.1. 1. Core Runtime Debugging</a>
<ul>
<li><a href="#orgd6cf7f5">2.1.1. QEMU</a></li>
<li><a href="#org79653fe">2.1.2. GDB (with vmlinux)</a></li>
<li><a href="#orgf36d1c3">2.1.3. KGDB</a></li>
<li><a href="#orgea01654">2.1.4. OpenOCD / JTAG</a></li>
</ul>
</li>
<li><a href="#tracing">2.2. 2. Tracing &amp; Timing</a>
<ul>
<li><a href="#orgcfbc3c7">2.2.1. Ftrace</a></li>
<li><a href="#orgd71602a">2.2.2. trace-cmd</a></li>
<li><a href="#orgb9d25de">2.2.3. perf / perf sched</a></li>
</ul>
</li>
<li><a href="#detectors">2.3. 3. Hang &amp; Stall Detectors</a>
<ul>
<li><a href="#org7b95822">2.3.1. Hard/Soft Lockup Watchdogs</a></li>
<li><a href="#orgbf501bc">2.3.2. Hung Task Detector</a></li>
<li><a href="#org5058342">2.3.3. RCU Stall Detector</a></li>
</ul>
</li>
<li><a href="#sanitizers">2.4. 4. Sanitizers &amp; Checkers</a></li>
<li><a href="#post-mortem">2.5. 5. Post-Mortem &amp; Field Debugging</a>
<ul>
<li><a href="#org09c1622">2.5.1. kdump / kexec + crash</a></li>
<li><a href="#orgbcbd38a">2.5.2. SysRq</a></li>
</ul>
</li>
<li><a href="#logging">2.6. 6. Instrumentation &amp; Logging</a>
<ul>
<li><a href="#orge5e7c14">2.6.1. printk / trace<sub>printk</sub></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#config">3. Essential Configuration</a>
<ul>
<li><a href="#orga8ae9cb">3.1. Kernel Build Configs</a></li>
<li><a href="#orgac101b7">3.2. Boot Command Line Options</a></li>
</ul>
</li>
<li><a href="#next-steps">4. Next Steps</a></li>
<li><a href="#resources">5. Resources</a></li>
</ul>
</div>
</div>
<blockquote>
<p>
It is with great happiness I&rsquo;m sharing that I was selected for the <b>LKMP Fall 2025</b> and this is a small write-up where I document the tools I will be using for this Bug Fixing Internship. I will be updating this as I get familiar with each tool. I got inspiration from the wonderful mentorship sessions and community resources.
</p>
</blockquote>
<div id="outline-container-baby-steps" class="outline-2">
<h2 id="baby-steps"><span class="section-number-2">1.</span> Baby Steps</h2>
<div class="outline-text-2" id="text-baby-steps">
<p>
My first plan is to find a bug reported by <b>syzbot</b> and fix it—it could be from any subsystem. I just want to get my feet wet and see how things evolve moving forward. I watched several mentorship sessions and got familiar with some of the tools people use for bug fixing.
</p>
</div>
<div id="outline-container-orgd8ba582" class="outline-3">
<h3 id="orgd8ba582"><span class="section-number-3">1.1.</span> Typical Workflow</h3>
<div class="outline-text-3" id="text-1-1">
<p>
From what I understood, here&rsquo;s a typical kernel debugging workflow:
</p>

<ol class="org-ol">
<li><b>Build kernel</b> with <code>CONFIG_DEBUG_INFO=y</code> <code>CONFIG_FRAME_POINTER=y</code></li>
<li><b>Boot QEMU</b> with <code>-s -S</code> and <code>nokaslr ftrace_dump_on_oops</code></li>
<li><b>Attach GDB</b>: <code>gdb vmlinux</code>, <code>target remote :1234</code>, set breakpoints</li>
<li><b>Trace</b>: <code>trace-cmd record ...</code> → <code>trace-cmd report</code></li>
<li><b>Measure scheduling</b>: <code>perf sched record</code>, <code>perf sched latency sort max</code></li>
<li><b>Enable watchdogs</b> &amp; hung task detectors</li>
<li><b>Sprinkle</b> <code>trace_printk()</code> in suspected paths</li>
<li><b>For production</b>: configure <b>kdump</b>, analyze dumps with <b>crash</b></li>
</ol>

<p>
Since I&rsquo;m just getting started, I&rsquo;ll begin with a bug reported by syzkaller and work my way through the process. My first tool will be <code>gdb</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-tools" class="outline-2">
<h2 id="tools"><span class="section-number-2">2.</span> Tools for Linux Kernel Bug Fixing</h2>
<div class="outline-text-2" id="text-tools">
<p>
While watching videos and reading documentation, I came across various debugging tools. Even though there&rsquo;s no single right way to find bugs, I&rsquo;ll use these as guideposts. I believe knowing multiple technologies gives us flexibility to find the easiest solutions.
</p>
</div>
<div id="outline-container-core-debugging" class="outline-3">
<h3 id="core-debugging"><span class="section-number-3">2.1.</span> 1. Core Runtime Debugging</h3>
<div class="outline-text-3" id="text-core-debugging">
</div>
<div id="outline-container-orgd6cf7f5" class="outline-4">
<h4 id="orgd6cf7f5"><span class="section-number-4">2.1.1.</span> QEMU</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Virtual machine emulator for running custom kernels—provides a safe, reproducible, scriptable test environment.
</p>

<div class="org-src-container">
<pre class="src src-bash">qemu-system-x86_64 \
  -kernel bzImage \
  -append "console=ttyS0 root=/dev/sda nokaslr" \
  -s -S \
  -nographic
</pre>
</div>

<ul class="org-ul">
<li><code>-s -S</code> exposes a GDB server on port 1234 and waits for debugger to attach</li>
<li><code>nokaslr</code> disables kernel address space layout randomization (easier debugging)</li>
</ul>
</div>
</div>
<div id="outline-container-org79653fe" class="outline-4">
<h4 id="org79653fe"><span class="section-number-4">2.1.2.</span> GDB (with vmlinux)</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Source-level debugger for the kernel in QEMU.
</p>

<p>
<b>Essential commands:</b>
</p>
<ul class="org-ul">
<li><code>target remote :1234</code> - Connect to QEMU</li>
<li><code>bt</code> - Backtrace (call stack)</li>
<li><code>info threads</code> - List all threads</li>
<li><code>b panic</code> - Set breakpoint at panic</li>
<li><code>list</code> - Show source code</li>
<li><code>disassemble</code> - Show assembly</li>
</ul>
</div>
</div>
<div id="outline-container-orgf36d1c3" class="outline-4">
<h4 id="orgf36d1c3"><span class="section-number-4">2.1.3.</span> KGDB</h4>
<div class="outline-text-4" id="text-2-1-3">
<p>
Kernel debugger stub for attaching GDB to real hardware via serial or network connection.
</p>
</div>
</div>
<div id="outline-container-orgea01654" class="outline-4">
<h4 id="orgea01654"><span class="section-number-4">2.1.4.</span> OpenOCD / JTAG</h4>
<div class="outline-text-4" id="text-2-1-4">
<p>
Hardware debugging path for very early boot failures and embedded systems.
</p>
</div>
</div>
</div>
<div id="outline-container-tracing" class="outline-3">
<h3 id="tracing"><span class="section-number-3">2.2.</span> 2. Tracing &amp; Timing</h3>
<div class="outline-text-3" id="text-tracing">
</div>
<div id="outline-container-orgcfbc3c7" class="outline-4">
<h4 id="orgcfbc3c7"><span class="section-number-4">2.2.1.</span> Ftrace</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Built-in low-overhead tracer (&ldquo;flight recorder&rdquo;) that&rsquo;s always available in the kernel.
</p>

<p>
<b>Useful boot parameters:</b>
</p>
<ul class="org-ul">
<li><code>ftrace_dump_on_oops</code> - Dump trace buffer on kernel crash</li>
<li><code>traceoff_on_warning</code> - Stop tracing on WARN</li>
<li><code>panic_on_warn=1</code> - Panic on any warning</li>
<li><code>trace_event=sched:sched_switch,cpu_idle</code> - Enable specific trace events</li>
</ul>
</div>
</div>
<div id="outline-container-orgd71602a" class="outline-4">
<h4 id="orgd71602a"><span class="section-number-4">2.2.2.</span> trace-cmd</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
User-friendly front-end to Ftrace.
</p>

<div class="org-src-container">
<pre class="src src-bash"># Record function graph for kfree
trace-cmd record -p function_graph -g kfree

# View the recorded trace
trace-cmd report
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb9d25de" class="outline-4">
<h4 id="orgb9d25de"><span class="section-number-4">2.2.3.</span> perf / perf sched</h4>
<div class="outline-text-4" id="text-2-2-3">
<p>
Scheduler profiling and latency analysis tool.
</p>

<div class="org-src-container">
<pre class="src src-bash"># Record scheduling events
perf sched record -- sleep 10

# Analyze scheduling latency
perf sched latency sort max

# View raw events
perf script
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-detectors" class="outline-3">
<h3 id="detectors"><span class="section-number-3">2.3.</span> 3. Hang &amp; Stall Detectors</h3>
<div class="outline-text-3" id="text-detectors">
</div>
<div id="outline-container-org7b95822" class="outline-4">
<h4 id="org7b95822"><span class="section-number-4">2.3.1.</span> Hard/Soft Lockup Watchdogs</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Detect CPUs that:
</p>
<ul class="org-ul">
<li><b>Hard lockup</b>: Stop servicing interrupts completely</li>
<li><b>Soft lockup</b>: Spin in kernel space too long</li>
</ul>

<pre class="example" id="org98eec77">
nmi_watchdog=1 watchdog_thresh=2
</pre>
</div>
</div>
<div id="outline-container-orgbf501bc" class="outline-4">
<h4 id="orgbf501bc"><span class="section-number-4">2.3.2.</span> Hung Task Detector</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Detects processes stuck in uninterruptible sleep (D state).
</p>

<div class="org-src-container">
<pre class="src src-bash">echo 10 &gt; /proc/sys/kernel/hung_task_timeout_secs
</pre>
</div>
</div>
</div>
<div id="outline-container-org5058342" class="outline-4">
<h4 id="org5058342"><span class="section-number-4">2.3.3.</span> RCU Stall Detector</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
Detects CPUs failing to pass RCU quiescent states (causing RCU grace periods to stall).
</p>

<pre class="example" id="org575c12a">
rcupdate.rcu_cpu_stall_timeout=20 panic_on_rcu_stall=1
</pre>
</div>
</div>
</div>
<div id="outline-container-sanitizers" class="outline-3">
<h3 id="sanitizers"><span class="section-number-3">2.4.</span> 4. Sanitizers &amp; Checkers</h3>
<div class="outline-text-3" id="text-sanitizers">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Tool</th>
<th scope="col" class="org-left">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><b>KASAN</b></td>
<td class="org-left">Detects memory bugs (use-after-free, out-of-bounds)</td>
</tr>

<tr>
<td class="org-left"><b>KCSAN</b></td>
<td class="org-left">Detects data races and concurrency bugs</td>
</tr>

<tr>
<td class="org-left"><b>LOCKDEP</b></td>
<td class="org-left">Validates locking correctness and deadlock detection</td>
</tr>

<tr>
<td class="org-left"><b>Preempt/IRQ-off tracers</b></td>
<td class="org-left">Find sections with long latency</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-post-mortem" class="outline-3">
<h3 id="post-mortem"><span class="section-number-3">2.5.</span> 5. Post-Mortem &amp; Field Debugging</h3>
<div class="outline-text-3" id="text-post-mortem">
</div>
<div id="outline-container-org09c1622" class="outline-4">
<h4 id="org09c1622"><span class="section-number-4">2.5.1.</span> kdump / kexec + crash</h4>
<div class="outline-text-4" id="text-2-5-1">
<p>
When the kernel panics:
</p>
<ol class="org-ol">
<li><code>kexec</code> boots a capture kernel</li>
<li>Memory is dumped to <code>vmcore</code></li>
<li>Analyze with <code>crash</code> utility for post-mortem debugging</li>
</ol>

<p>
This is essential for production systems where you can&rsquo;t run live debuggers.
</p>
</div>
</div>
<div id="outline-container-orgbcbd38a" class="outline-4">
<h4 id="orgbcbd38a"><span class="section-number-4">2.5.2.</span> SysRq</h4>
<div class="outline-text-4" id="text-2-5-2">
<p>
Magic key combinations for emergency actions:
</p>
<ul class="org-ul">
<li><code>Alt + SysRq + t</code> - Show task states</li>
<li><code>Alt + SysRq + w</code> - Show blocked tasks</li>
<li><code>Alt + SysRq + m</code> - Show memory info</li>
<li><code>Alt + SysRq + c</code> - Trigger crash dump</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-logging" class="outline-3">
<h3 id="logging"><span class="section-number-3">2.6.</span> 6. Instrumentation &amp; Logging</h3>
<div class="outline-text-3" id="text-logging">
</div>
<div id="outline-container-orge5e7c14" class="outline-4">
<h4 id="orge5e7c14"><span class="section-number-4">2.6.1.</span> printk / trace<sub>printk</sub></h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
<b>printk:</b> Traditional kernel logging
</p>
<div class="org-src-container">
<pre class="src src-c">printk(KERN_DEBUG "Debug info: value=%d\n", value);
</pre>
</div>

<p>
<b>trace<sub>printk</sub>:</b> Writes to Ftrace buffer (much lower overhead)
</p>
<div class="org-src-container">
<pre class="src src-c">trace_printk("Fast logging: value=%d\n", value);
</pre>
</div>

<div class="note" id="org50b9207">
<p>
Use sampling (log every Nth occurrence) to avoid flooding logs and affecting timing.
</p>

</div>
</div>
</div>
</div>
</div>
<div id="outline-container-config" class="outline-2">
<h2 id="config"><span class="section-number-2">3.</span> Essential Configuration</h2>
<div class="outline-text-2" id="text-config">
</div>
<div id="outline-container-orga8ae9cb" class="outline-3">
<h3 id="orga8ae9cb"><span class="section-number-3">3.1.</span> Kernel Build Configs</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Enable these in your <code>.config</code>:
</p>

<div class="org-src-container">
<pre class="src src-conf">CONFIG_DEBUG_INFO=y           # Include debug symbols
CONFIG_FRAME_POINTER=y        # Better backtraces
CONFIG_GDB_SCRIPTS=y          # GDB helper scripts
CONFIG_DEBUG_KERNEL=y         # General debug options
CONFIG_KASAN=y                # Address sanitizer (optional but recommended)
CONFIG_LOCKDEP=y              # Lock dependency validator
</pre>
</div>
</div>
</div>
<div id="outline-container-orgac101b7" class="outline-3">
<h3 id="orgac101b7"><span class="section-number-3">3.2.</span> Boot Command Line Options</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Add these to your kernel command line for better debugging:
</p>

<pre class="example" id="org18a260f">
nokaslr                       # Disable ASLR for easier debugging
panic_on_warn=1               # Treat warnings as panics
traceoff_on_warning           # Stop tracing on warnings
ftrace_dump_on_oops           # Dump trace buffer on crash
debug                         # Enable debug messages
</pre>
</div>
</div>
</div>
<div id="outline-container-next-steps" class="outline-2">
<h2 id="next-steps"><span class="section-number-2">4.</span> Next Steps</h2>
<div class="outline-text-2" id="text-next-steps">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> Set up QEMU testing environment</li>
<li class="off"><code>[&#xa0;]</code> Build debug kernel with proper configs</li>
<li class="off"><code>[&#xa0;]</code> Pick a syzbot bug to investigate</li>
<li class="off"><code>[&#xa0;]</code> Document the debugging process</li>
<li class="off"><code>[&#xa0;]</code> Submit first patch!</li>
</ul>
</div>
</div>
<div id="outline-container-resources" class="outline-2">
<h2 id="resources"><span class="section-number-2">5.</span> Resources</h2>
<div class="outline-text-2" id="text-resources">
<ul class="org-ul">
<li><a href="https://docs.kernel.org/dev-tools/index.html">Kernel Development Tools Documentation</a></li>
<li><a href="https://www.kernel.org/doc/html/latest/trace/ftrace.html">Ftrace Documentation</a></li>
<li><a href="https://syzkaller.appspot.com/">Syzbot Dashboard</a></li>
<li><a href="https://kernelnewbies.org/">Kernel Newbies</a></li>
</ul>

<div class="org-center">
<p>
&#x2014;
</p>

<p>
<i>This document is a living document and will be updated as I progress through LKMP.</i>
</p>

<p>
<i>Last updated: 2025-10-29</i>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2025-10-29</p>
<p class="author">Author: Albin Babu Varghese</p>
<p class="date">Created: 2025-10-29 Wed 21:32</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
